# fabric-operation

Operation scripts for creating and managing Hyperledger Fabric networks.

## Prerequisites
* Install Docker and Docker Compose as described [here](https://docs.docker.com/compose/install/).

## Start CA server and generate crypto data
```
cd ./ca
./start-ca.sh
./bootstrap.sh
./stop-ca.sh
```
These steps generates crypto data for a sample network operator, i.e., _netop1.com_.  The sample network is defined in the config file [netop1.env](./config/netop1.env).  Each of the above scripts accepts an optional argument that specifies which config file to load, e.g., `./start-ca.sh org1` would load the network config from file [org1.env](./config/org1.env).

After the network config is defined, the following steps can be used to generate crypto data from CA servers:
* Configure and start CA server and TLS CA server using the script [start-ca.sh](./ca/start-ca.sh).
* Generate crypto data for the specified network, using the script [bootstrap.sh](./ca/bootstrap.sh).
* Shutdown CA servers and cleanup work files, using the script [stop-ca.sh](./ca/stop-ca.sh).

## Sample crypto data
Sample crypto data generated by the above steps are show in [netop1.com](./netop1.com).

It uses the same folder structure as the result from _cryptogen_ that is demonstrated by [fabric-samples](https://github.com/hyperledger/fabric-samples). However, by using CA server, our scripts are more flexible and adaptable for production environment.

## Optional: start sample Fabric network, and verify the crypto data
You may manually configure a Fabric network to verify the correctness of the generated crypto data according to the steps described in [netop1-network](./netop1-network). This is useful only if you have changed the CA scripts or upgraded the CA servers.

The following steps will generate the MSP definisions and Fabric network configurations, and so you will not have to manually configure the docker containers.

## Generate MSP definition and genesis block
```
cd ./msp
./bootstrap.sh
```
This command, [bootstrap.sh](./msp/bootstrap.sh), creates the MSP definition and network profiles, [configtx.yaml](./netop1.com/artifacts/configtx.yaml) for the sample network, and uses the network profiles to create orderer genesis block and transaction for creating a test channel, _mychannel_, as specified in the onfig file [netop1.env](./config/netop1.env).  The resulting artifacts are stored in folder [artifacts](./netop1.com/artifacts).

Similar to previous commands, you can provide an optional argument to this script to load different network config, e.g., `./bootstrap.sh org1`.

## Configure and start Fabric network
```
cd ./network
./bootstrap.sh
./start-network.sh
./run-test.sh
./stop-network.sh
```
These commands does the following:
* Generate docker compose yaml files for the Fabric network using the script [bootstrap.sh](./network/bootstrap.sh).  The resulting yaml files are stored in folder [network](./netop1.com/network).
* Start the fabric network specified by the docker compose yaml, using the script [start-network.sh](./network/start-network.sh).
* Use the script [run-test.sh](./network/run-test.sh) to create test channel, join a peer to the channel, install a test [chaincode](./chaincode/chaincode_example02/go), and invoke chaincode transactions.
* Use the script [stop-network.sh](./network/stop-network.sh) to stop the network and cleanup the docker containers and images.

## TODO
Will soon enhance these scripts to support Kubernetes and popular cloud service providers.